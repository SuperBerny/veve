<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta http-equiv="X-UA-Compatible" content="ie=edge">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"
   integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
   <title>Main</title>
</head>
<body>

<div class="jumbotron jumbotron-fluid bg-info text-white">
   <div class="container text-center">
      <h1 class="display-3">Wardrobe App</h1>
      <p class="lead">Login/Sign UP</p>
   </div>
</div>

<div class="container">
  <form id="loginForm">
     <div class="form-group row">
        <label class="col-sm-2 col-form-label" for="email">Email</label>
           <div class="col-sm-10">
                 <input name="email" type="email" class="form-control" aria-describedby="emailHelp" placeholder="Enter email">
           </div>
     </div>
     <div class="form-group row">
        <label class="col-sm-2 col-form-label" for="password">Password</label>
        <div class="col-sm-10">
              <input name="password" type="password" class="form-control" placeholder="Password">
           </div>
     </div>
     <div class="form-group row text-center">
        <div class="col">
           <button id="loginButton" type="submit" class="btn btn-info">Login</button>
           <button id="signUpButton" type="button" class="btn btn-info">Sign Up</button>
        </div>
     </div>
  </form>
</div>

<div class="modal" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modal-title"></h5>
      </div>
      <div class="modal-body">
        <p id="modal-message"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Dismiss</button>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

<script>
var loginSuccessURL = "/closets";

$(document).ready(function() {
  var form = $("#loginForm");
  var emailField = $("input[name=email]");
  var passwordField = $("input[name=password]");
  var login = $("#loginButton");
  var signUp = $("#signUpButton");

  signUp.click(function(e) {
    e.preventDefault();
    window.location="signUp.html";
  });

  login.click(function(e) {
    e.preventDefault();
    var email = emailField.val().trim();
    var password = passwordField.val().trim();
    if (email.length > 0 && password.length > 0) {
      var credentials = btoa(email + ":" + password); // base64 encode credentials
      $.ajax({
        method: "GET",
        url: "/api/token",
        beforeSend: function(xhr) {
          xhr.setRequestHeader(
            "Authorization",
            `Basic ${credentials}`
          );
        }
      })
      .done(function(response) {
        localStorage.setItem("access_token", response.token);
        window.location = loginSuccessURL;
      })
      .fail(function(err) {
        if (err.status === 403) {
          emailField.addClass("is-invalid");
          passwordField.addClass("is-invalid");
        }
      });
    }
  });
});
</script>

</body>
</html>
